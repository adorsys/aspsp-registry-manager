"use strict";function initGlobals(){window.FILE_UPLOAD_FIELD=document.querySelector("#import-field"),window.HIDDEN_ROW=document.querySelector("tbody>tr.hidden"),window.WARNING=document.querySelector(".alert.warning"),window.FAILURE=document.querySelector(".alert.failure"),window.SUCCESS=document.querySelector(".alert.success"),window.COUNTER=0,window.DEFAULT_DATA=returnTestData()}function validateBankName(e){var t=e.textContent;/^[a-zA-Z0-9-\s]*$/.test(t)||""===t?(e.style.background="none",e.classList.remove("invalid")):(e.style.background="rgba(255, 152, 0, 0.2)",e.classList.add("invalid"),warning("Bank name should be a plain text, e.g. there shouldn't be symbols like #, @, *, %, etc."))}function validateBic(e){toUpper(e);var t=e.textContent;11===t.length&&/^[A-Z0-9]*$/.test(t)||""===t?(e.style.background="none",e.classList.remove("invalid")):(e.style.background="rgba(255, 152, 0, 0.2)",e.classList.add("invalid"),warning("BIC should be 11 characters long and consist of aA-zZ, 0-9"))}function validateUrl(e){var t=e.textContent;/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(t)||""===t?(e.style.background="none",e.classList.remove("invalid")):(e.style.background="rgba(255, 152, 0, 0.2)",e.classList.add("invalid"),warning("URL format is wrong, e.g. right format is https://example.test"))}function validateAdapterId(e){var t=e.textContent;/^[a-zA-Z0-9-]*$/.test(t)||""===t?(e.style.background="none",e.classList.remove("invalid")):(e.style.background="rgba(255, 152, 0, 0.2)",e.classList.add("invalid"),warning("Adapter Id should consist of aA-zZ, 0-9 and a hyphen(-) only, e.g. 'Adapter-12345'"))}function validateBankCode(e){var t=e.textContent;8===t.length&&/^[0-9]*$/.test(t)||""===t?(e.style.background="none",e.classList.remove("invalid")):(e.style.background="rgba(255, 152, 0, 0.2)",e.classList.add("invalid"),warning("Bank Code should consist of numbers only"))}function toUpper(e){e.innerText=e.innerText.toUpperCase()}function forceValidation(){document.querySelectorAll("tr").forEach(function(e){var t=!0,a=!1,n=void 0;try{for(var i,d=e.cells[Symbol.iterator]();!(t=(i=d.next()).done);t=!0){var o=i.value;o.classList.contains("invalid")&&(o.classList.remove("invalid"),o.style.background="none",console.log("Cell with content '"+o.textContent+"' is made valid"))}}catch(e){a=!0,n=e}finally{try{t||null==d.return||d.return()}finally{if(a)throw n}}})}function uneditableCells(e){for(var t=e.parentElement.parentElement.cells,a=e.parentElement.parentElement.querySelectorAll("input"),n=1,i=t.length-1;n<i;n++)t[n].removeAttribute("contenteditable");a.forEach(function(e){e.disabled=!0})}function editableCells(e){for(var t=e.parentElement.parentElement.cells,a=e.parentElement.parentElement.querySelectorAll("input"),n=1,i=t.length-2;n<i;n++)t[n].setAttribute("contenteditable",!0);a.forEach(function(e){e.disabled=!1})}function showTable(){var e=HIDDEN_ROW.parentElement.parentElement.parentElement,t=document.querySelector(".welcome-message");e.hidden=!1,t.hidden=!0}function clearTable(){var e=document.querySelectorAll("tbody>tr");1<e.length&&e.forEach(function(e){e.className||e.remove()})}function clearContent(){clearTable(),document.querySelectorAll(".mdl-textfield__input").forEach(function(e){e.value="",e.parentElement.classList.remove("is-dirty")})}function onEnterPress(e){13===e.keyCode&&search()}function addTooltips(e){var t="edit-",a="update-",n="delete-";if(-1<e.className.indexOf("edit")){var i=e.parentNode.childNodes[7];e.addEventListener("click",function(){editButton(e)}),e.setAttribute("id",t+COUNTER),i.setAttribute("data-mdl-for",t+COUNTER),i.setAttribute("class","mdl-tooltip mdl-tooltip--top")}if(-1<e.className.indexOf("update")){var d=e.parentNode.childNodes[9];e.addEventListener("click",function(){greenButton(e)}),e.setAttribute("id",a+COUNTER),d.setAttribute("data-mdl-for",a+COUNTER),d.setAttribute("class","mdl-tooltip mdl-tooltip--top")}if(-1<e.className.indexOf("delete")){var o=e.parentNode.childNodes[11];e.addEventListener("click",function(){redButton(e)}),e.setAttribute("id",n+COUNTER),o.setAttribute("data-mdl-for",n+COUNTER),o.setAttribute("class","mdl-tooltip mdl-tooltip--top")}}function purgeRow(e){e.parentElement.parentElement.remove()}function assembleRowData(e){var t,a,n,i=e.parentNode.parentNode,d={};return d.id=i.cells[0].textContent,d.name=i.cells[1].textContent,d.bic=i.cells[2].textContent,d.url=i.cells[3].textContent,d.adapterId=i.cells[4].textContent,d.bankCode=i.cells[5].textContent,d.idpUrl=i.cells[6].textContent,d.scaApproaches=(t=i.cells[7],a=t.querySelectorAll("input"),n=[],a.forEach(function(e){e.checked&&n.push(e.name)}),n),JSON.stringify(d)}function buildRow(e){var t=HIDDEN_ROW.cloneNode(!0);t.removeAttribute("class"),t.cells[0].textContent=e.id,t.cells[1].textContent=e.name,t.cells[2].textContent=e.bic,t.cells[3].textContent=e.url,t.cells[4].textContent=e.adapterId,t.cells[5].textContent=e.bankCode,t.cells[6].textContent=e.idpUrl,function(e,t){if(!e)return;var a=t.querySelectorAll("input");e.forEach(function(e){switch(e){case"EMBEDDED":a[0].checked=!0;break;case"REDIRECT":a[1].checked=!0;break;case"DECOUPLED":a[2].checked=!0;break;case"OAUTH":a[3].checked=!0}})}(e.scaApproaches,t.cells[7]),t.lastElementChild.childNodes.forEach(function(e){e.className&&addTooltips(e)}),document.querySelector("table>tbody").appendChild(t),COUNTER++,componentHandler.upgradeAllRegistered()}function returnTestData(){return JSON.parse('[ { "id" : "3d949fee-81ec-4329-ba2f-971705e9ac2e", "name" : "VR-Bank Bonn eG", "bic" : "GENODED1HBO", "bankCode" : "38160220", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "226:1.0675461" }, { "id" : "33b2f39c-1519-4592-8db4-f2591682db2b", "name" : "VR-Bank Bonn eG", "bic" : "GENODED1BGK", "bankCode" : "", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "712:1.0675461" }, { "id" : "5f5db2fd-a862-43de-8fbb-893198f92aa4", "name" : "VR Bank M端nchen Land", "bic" : "GENODEF1OHC", "bankCode" : "70166486", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "715:1.0675461" }, { "id" : "1c8ddd14-e05c-4995-b672-03723a40b8ca", "name" : "LIGA Bank", "bic" : "GENODEF1M05", "bankCode" : "75090300", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "623:0.9450702" }, { "id" : "7c5272a1-bcbd-42b7-b020-c28d73d08d01", "name" : "M端nchner Bank", "bic" : "GENODEF1M02", "bankCode" : "70160300", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "627:0.9450702" }, { "id" : "274cdfbf-e50c-47b1-8e2f-119eec2fc443", "name" : "M端nchner Bank", "bic" : "GENODEF1M01", "bankCode" : "70190000", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "628:0.9450702" }, { "id" : "fc4f7e7d-c095-4a26-a41f-7c5c8a77ba37", "name" : "Merkur Bank", "bic" : "GENODEF1M06", "bankCode" : "70130800", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "631:0.9450702" }, { "id" : "3c872dbd-2d38-4c09-aead-5e7612251b71", "name" : "Waldecker Bank", "bic" : "GENODEF1KBW", "bankCode" : "52360059", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "662:0.9450702" }, { "id" : "0dd3397e-b09b-4c2d-a01e-754e3f202f21", "name" : "VR Bank", "bic" : "GENODE51BEC", "bankCode" : "55362071", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "665:0.9450702" }, { "id" : "4a33bfc4-6711-4dd3-a077-6e2c2d9a48dc", "name" : "GRENKE BANK", "bic" : "GREBDEH1XXX", "bankCode" : "20130400", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "682:0.9450702" }, { "id" : "094c849d-1af3-479a-870d-79600389ae76", "name" : "BRANDENBURGER BANK", "bic" : "GENODEF1BRB", "bankCode" : "16062073", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "759:0.9450702" }, { "id" : "2245bc2d-dc83-47e8-b517-34efe63fc1e5", "name" : "M端nchner Bank", "bic" : "GENODEF1OBS", "bankCode" : "70169493", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "790:0.9450702" }, { "id" : "149ac3bb-e508-41e8-bf32-20b1ff085243", "name" : "Westerwald Bank", "bic" : "GENODE51WW1", "bankCode" : "57391800", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "806:0.9450702" }, { "id" : "14ba28f9-2d10-47c8-9eb9-97e3c68b919a", "name" : "Schrobenhausener Bank", "bic" : "GENODEF1SHV", "bankCode" : "", "url" : "https://xs2a-test.fiduciagad.de/xs2a", "adapterId" : "fiducia-adapter", "paginationId" : "824:0.9450702" }, { "id" : "e990080e-a292-487b-931d-9dd179fa55fe", "name" : "Olb Bank", "bic" : "OLBODEH2XXX", "bankCode" : "25621327", "url" : "https://xs2a-int.olb.de/xs2a", "adapterId" : "olb-adapter", "paginationId" : "826:0.9450702" }, { "id" : "597836f9-054d-4e34-beec-2e16af9e2671", "name" : "Olb Bank", "bic" : "OLBODEH2XXX", "bankCode" : "26520017", "url" : "https://xs2a-int.olb.de/xs2a", "adapterId" : "olb-adapter", "paginationId" : "827:0.9450702" }, { "id" : "0560761b-fda4-4b2f-b4bc-b391e947332a", "name" : "Olb Bank", "bic" : "OLBODEH2XXX", "bankCode" : "26521703", "url" : "https://xs2a-int.olb.de/xs2a", "adapterId" : "olb-adapter", "paginationId" : "828:0.9450702" }, { "id" : "50ed12d4-c717-4fb6-bcd4-6cacbff772f9", "name" : "Olb Bank", "bic" : "OLBODEH2XXX", "bankCode" : "26522319", "url" : "https://xs2a-int.olb.de/xs2a", "adapterId" : "olb-adapter", "paginationId" : "829:0.9450702" }, { "id" : "0dadfd89-2e57-4573-8ae1-3b35d0e51357", "name" : "Olb Bank", "bic" : "OLBODEH2XXX", "bankCode" : "26620010", "url" : "https://xs2a-int.olb.de/xs2a", "adapterId" : "olb-adapter", "paginationId" : "830:0.9450702" }, { "id" : "888be9a6-6f3e-409f-9b89-4e6094d59775", "name" : "Olb Bank", "bic" : "OLBODEH2XXX", "bankCode" : "26621413", "url" : "https://xs2a-int.olb.de/xs2a", "adapterId" : "olb-adapter", "paginationId" : "831:0.9450702" } ]')}function fail(e){FAILURE.querySelector(".message").textContent=e,setTimeout(function(){FAILURE.style.opacity=1},500),setTimeout(function(){FAILURE.style.opacity=0},8e3)}function success(){setTimeout(function(){SUCCESS.style.opacity=1},500),setTimeout(function(){SUCCESS.style.opacity=0},8e3)}function warning(e){var t=WARNING.querySelector(".message");e&&(t.textContent=e),setTimeout(function(){WARNING.style.opacity=1},500),setTimeout(function(){WARNING.style.opacity=0},8e3)}function addRow(){var e=HIDDEN_ROW.cloneNode(!0);e.cells[0].textContent="some id",e.removeAttribute("class"),e.setAttribute("class","new"),e.lastElementChild.childNodes.forEach(function(e){e.className&&(addTooltips(e),editButton(e))}),document.querySelector("table>tbody").appendChild(e),COUNTER++,HIDDEN_ROW.parentElement.parentElement.parentElement.hidden&&showTable(),componentHandler.upgradeAllRegistered()}function saveButton(t){var a=t.parentElement.parentElement,e=!0,n=!1,i=void 0;try{for(var d,o=a.cells[Symbol.iterator]();!(e=(d=o.next()).done);e=!0){if(d.value.classList.contains("invalid"))return void warning()}}catch(e){n=!0,i=e}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}fetch("/v1/aspsps/",{method:"POST",headers:{"Content-Type":"application/json"},body:assembleRowData(t)}).then(function(e){if(201!==e.status)throw RangeError(e.statusText);return a.removeAttribute("class"),toggleButtons(t),e.text()}).then(function(e){var t=JSON.parse(e);a.cells[0].textContent=t.id}).catch(function(){fail("Saving process has failed")})}function updateButton(t){var e=t.parentElement.parentElement,a=!0,n=!1,i=void 0;try{for(var d,o=e.cells[Symbol.iterator]();!(a=(d=o.next()).done);a=!0){if(d.value.classList.contains("invalid"))return void warning()}}catch(e){n=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(n)throw i}}fetch("/v1/aspsps/",{method:"PUT",headers:{"Content-Type":"application/json"},body:assembleRowData(t)}).then(function(e){if(!e.ok)throw Error(e.statusText);return e}).then(function(e){e.ok&&toggleButtons(t)}).catch(function(){fail("Update process has failed")})}function deleteButton(t){var e=t.parentElement.parentElement.cells[0].innerText;fetch("/v1/aspsps/"+e,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(function(e){if(204!==e.status)throw Error(e.statusText);return purgeRow(t),e}).catch(function(){fail("Deleting process has fialed")})}function persist(){fetch("v1/aspsps/persist",{method:"POST"}).then(function(e){if(!e.ok)throw Error(e.statusText);success()}).catch(function(){fail("Could not update Lucene indexes")})}function upload(){var e=FILE_UPLOAD_FIELD.files[0],t=new FormData;t.append("file",e),fetch("/v1/aspsps/import",{method:"POST",body:t}).then(function(e){if(!e.ok)throw Error(e.statusText);success()}).catch(function(){fail("Failed to upload the file. It looks like the file has an inappropriate format.")})}function search(){clearTable();var e=document.querySelector(".search-form"),t="/v1/aspsps/?";""!==e[0].value&&(t+="name="+e[0].value.toLowerCase()+"&"),""!==e[1].value&&(t+="bic="+e[1].value+"&"),""!==e[2].value&&(t+="bankCode="+e[2].value+"&"),t+="size=9999",fetch(t).then(function(e){if(!e.ok)throw Error(e.statusText);return e}).then(function(e){return e.text()}).then(function(e){return paginate(JSON.parse(e))}).catch(function(){fail("Failed to find any records. Please double check input parameters.")}),HIDDEN_ROW.parentElement.parentElement.parentElement.hidden&&showTable()}function editButton(e){var t=e.parentNode.children[0],a=e.parentNode.children[1],n=e.parentNode.children[2];"none"!==t.style.display&&(t.style.display="none",a.style.display="inherit",n.style.display="inherit",editableCells(e))}function toggleButtons(e){var t=e.parentNode.children[0],a=e.parentNode.children[1],n=e.parentNode.children[2];"none"===t.style.display?(t.style.display="inherit",a.style.display="none",n.style.display="none",uneditableCells(e)):(t.style.display="none",a.style.display="inherit",n.style.display="inherit",editableCells(e))}function greenButton(e){e.parentElement.parentElement.className?window.confirm("Are you sure you want to save the new entry?")&&saveButton(e):window.confirm("Are you sure you want to update the aspsp?")?updateButton(e):toggleButtons(e)}function redButton(e){e.parentElement.parentElement.className?purgeRow(e):window.confirm("You you sure you want to delete this aspsp record?")?deleteButton(e):toggleButtons(e)}function paginate(e){var t=e.length,a=0,n=document.querySelector(".show-more"),i=document.querySelector(".total");function d(){for(limit=a+(t<10?t:10);a<limit;a++)buildRow(e[a]);n.hidden=!(a<t)}d(),i.innerHTML=t,n.addEventListener("click",d)}setTimeout(function(){initGlobals(),document.querySelector("#import>button").addEventListener("click",function(){return FILE_UPLOAD_FIELD.click()}),FILE_UPLOAD_FIELD.addEventListener("change",upload),document.querySelectorAll(".mdl-textfield__input").forEach(function(e){return e.addEventListener("keypress",function(e){return onEnterPress(e)})})},0);